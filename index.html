<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูููุฉ ุฑูุญูุฉ - ูุตู ุชููุฐุฉ</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
        /* ููุฏ CSS ููุฑุณุงุฆู (ููู ููุฌูุฏ ุญุงูุฉ loading ู success/error) */
        #message {
            margin-top: 15px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }
        #message.success { color: green; }
        #message.error { color: red; }
        #message.loading { color: orange; }
        
        /* ุฅุถุงูุฉ ุญุงูุฉ ุงูุฒุฑ ุงููุนุทู ูููุน ุงูุฅุฑุณุงู ุงููุชุนุฏุฏ */
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important; 
            box-shadow: none !important;
        }
    </style>
</head>

<body>

    <header>
        <h2>Kirellos George</h2>
    </header>

    <section class="hero">
        <img src="Screenshot_2025-11-26_201754-removebg-preview.png" alt="logo" class="logo">
        <h1>ูุตู ุชููุฐุฉ<br>ููุชุฉ ุฑูุญูุฉ</h1>
        <p>ููุจ ุณุงูุช ูุตูู ููุชุงุจุนุฉ ุงูููู ุงูุฑูุญู ููุตูู ุชููุฐุฉ</p>
        <button class="main-btn">ุงูููุชุฉ</button>
        
            </section>

    <section class="form-section">

<div class="streak-container">
            <div class="streak-card">
                <span class="fire-icon">๐ฅ</span>
                <div class="streak-info">
                    <h3>ุญูุงุณู ุงูุฑูุญู</h3>
                    <p><span id="streakCount" class="streak-number">0</span> ุฃูุงู ูุชูุงุตูุฉ</p>
                </div>
            </div>
        </div>
        <h3>ุงูุณุชุฑูู ุชุญุช ุงูุชุฌุฑุจู</h3>

        <div class="row">
            <span>ุงูุงุณู :</span>
            <input type="text" id="studentName" placeholder="ุงูุชุจ ุงุณูู ููุง">
        </div>

        <div class="date-container">
            <input type="date" id="dateField">
        </div>

        <div class="row">
            <span>ุงูุฅูุฌูู :</span>
            <div>
                <label>NO <input type="radio" name="gospel" value="No"></label>
                <label>YES <input type="radio" name="gospel" value="Yes"></label>
            </div>
        </div>

        <div class="row">
            <span>ุงูุงุนุชุฑุงู :</span>
            <div>
                <label>NO <input type="radio" name="confession" value="No"></label>
                <label>YES <input type="radio" name="confession" value="Yes"></label>
            </div>
        </div>

        <div class="row">
            <span>ุงูุชูุงูู :</span>
            <div>
                <label>NO <input type="radio" name="communion" value="No"></label>
                <label>YES <input type="radio" name="communion" value="Yes"></label>
            </div>
        </div>

        <div class="row">
            <span>ุชูููุช ุงููุฑุงุกุฉ/ุงูุตูุงุฉ :</span>
            <div>
                <label>ุจุงูุฑ <input type="checkbox" name="readingTime" value="ุจุงูุฑ"></label>
                <label>ุงูุบุฑูุจ <input type="checkbox" name="readingTime" value="ุงูุบุฑูุจ"></label>
                <label>ุงูููู <input type="checkbox" name="readingTime" value="ุงูููู"></label>
            </div>
        </div>

        <div class="row">
            <span>ุงุฎุชุงุฑ ุงุดุจููู :</span>
            <select id="teacherSelect">
                <option value="">ุงุฎุชุงุฑ ุงุดุจููู</option>
                <option value="ุงุณุชุงุฐ ุจูุดูู ูุงูู">ุงุณุชุงุฐ ุจูุดูู ูุงูู</option>
                <option value="ุงุณุชุงุฐ ุงูููู">ุงุณุชุงุฐ ุงูููู</option>
                <option value="ุงุณุชุงุฐ ุฌูุฒูู">ุงุณุชุงุฐ ุฌูุฒูู</option>
                <option value="ุงุณุชุงุฐ ุจูุดูู ุตุจุฑู">ุงุณุชุงุฐ ุจูุดูู ุตุจุฑู</option>
                <option value="ุทุงุณููู ููุฑูุง">ุทุงุณููู ููุฑูุง</option>
                <option value="ุทุงุณููู ุงูููุช">ุทุงุณููู ุงูููุช</option>
                <option value="ุทุงุณููู ุฏุงููุง">ุทุงุณููู ุฏุงููุง</option>
                <option value="ุทุงุณููู ุงูุงู">ุทุงุณููู ุงูุงู</option>
                <option value="ุทุงุณููู ุงูุฏูุช">ุทุงุณููู ุงูุฏูุช</option>
                <option value="ุทุงุณููู ูุฑูุณุชูู">ุทุงุณููู ูุฑูุณุชูู</option>
            </select>
        </div>

        <button class="submit-btn" id="submitButton">ุฅุฑุณุงู</button>
        <div id="message"></div>

    </section>

<script>
    // --- 1. STREAK LOGIC (ููุฏ ุงูุนุฏุงุฏ) ---
    function updateStreakDisplay() {
        const count = localStorage.getItem('spiritualStreak') || 0;
        document.getElementById('streakCount').textContent = count;
    }

    function checkAndIncrementStreak(gospelValue, prayerValue) {
        // ุงููุงุนุฏุฉ: ูุงุฒู ูููู ูุฑุฃ ุฅูุฌูู ูุตูู ุนุดุงู ุงูุนุฏุงุฏ ูุฒูุฏ
        if (gospelValue === "Yes" && prayerValue !== "ูู ูุชู ุงูุงุฎุชูุงุฑ") {
            
            const todayStr = new Date().toDateString(); 
            const lastLogDate = localStorage.getItem('lastStreakDate');
            let currentStreak = parseInt(localStorage.getItem('spiritualStreak') || '0');

            // 1. ูู ููุณ ุงููููุ ููุฒูุฏุด
            if (lastLogDate === todayStr) {
                return; 
            }

            // 2. ูู ุงูุชุงุฑูุฎ ุงูุจุงุฑุญุ ูุฒูุฏ 1
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (lastLogDate === yesterday.toDateString()) {
                currentStreak++;
            } 
            // 3. ูู ูุงุชู ููู ุฃู ุฃูู ูุฑุฉุ ูุจุฏุฃ ูู 1 (ุฅุนุงุฏุฉ ุงูุชุนููู)
            else {
                currentStreak = 1;
            }

            // ุญูุธ
            localStorage.setItem('spiritualStreak', currentStreak);
            localStorage.setItem('lastStreakDate', todayStr);
            updateStreakDisplay();
        }
    }

    // ุชุดุบูู ุงูุนุฑุถ ุนูุฏ ุงูุชุญููู
    updateStreakDisplay();

    // --- 2. SENDING LOGIC (ููุฏ ุงูุฅุฑุณุงู) ---
    const submitButton = document.getElementById("submitButton");
    let isSending = false;

    // ุชุฃูุฏ ุฃู ูุฐุง ุงูุฑุงุจุท ูู ููุณู ุงูุฑุงุจุท ุงูุฐู ุณุชุญุตู ุนููู ุจุนุฏ ูุดุฑ Google Script
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz6GL3CFFEyCH7GBP-I51LyTzMRVfmihfpX-ONCFwOKMBKJdzHbWibnErBSOhqAaJsB/exec";

    submitButton.addEventListener("click", async () => {
        if (isSending) return;

        const name = document.getElementById("studentName").value.trim();
        const date = document.getElementById("dateField").value;
        const teacher = document.getElementById("teacherSelect").value;
        const gospel = document.querySelector('input[name="gospel"]:checked')?.value;
        const confession = document.querySelector('input[name="confession"]:checked')?.value;
        const communion = document.querySelector('input[name="communion"]:checked')?.value;
        
        const selectedTimes = Array.from(document.querySelectorAll('input[name="readingTime"]:checked'))
            .map(checkbox => checkbox.value).join(", ");
        
        const prayer = selectedTimes || "ูู ูุชู ุงูุงุฎุชูุงุฑ"; 
        
        // ๐ฅ ุงูุญุตูู ุนูู ูููุฉ ุงูุณุชุฑูู ุงูุญุงููุฉ ูุฅุฑุณุงููุง
        const currentStreak = localStorage.getItem('spiritualStreak') || '0';

        const messageBox = document.getElementById("message");

        if (!name || !date || !teacher || !gospel || !confession || !communion || prayer === "ูู ูุชู ุงูุงุฎุชูุงุฑ") {
            messageBox.textContent = "โ ูู ูุถูู ุฃููู ุฌููุน ุงูุญููู ุงููุทููุจุฉ";
            messageBox.className = "error";
            return;
        }

        isSending = true; 
        submitButton.disabled = true; 
        messageBox.textContent = "ุฌุงุฑู ุงูุฅุฑุณุงู...";
        messageBox.className = "loading";

        try {
            const res = await fetch(
                SCRIPT_URL,
                {
                    method: "POST",
                    body: new URLSearchParams({
                        name, 
                        date, 
                        teacher, 
                        gospel, 
                        confession, 
                        communion, 
                        prayer,
                        streak: currentStreak // ุฅุฑุณุงู ุงูุนุฏุงุฏ ุฅูู ุงูุณูุฑูุจุช
                    })
                }
            );

            const text = await res.text();
            messageBox.textContent = text;
            messageBox.className = text.includes("โ") ? "success" : "error";

            // ๐ฅ ุชุญุฏูุซ ุงูุนุฏุงุฏ ููุท ูู ุงูุฅุฑุณุงู ูุฌุญ
            if (text.includes("โ") || res.ok) {
                checkAndIncrementStreak(gospel, prayer);
            }

        } catch (err) {
            messageBox.textContent = "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู. ุงูุฑุฌุงุก ุงููุญุงููุฉ ูุงุญููุง.";
            messageBox.className = "error";
        } finally {
            isSending = false; 
            submitButton.disabled = false; 
        }
    });
</script>

</body>
</html>


